The following backup script serves as an **example** of how a simple data backup can be arranged. It does not replace a professional solution!

At your own risk

This script deletes files! Please use at your own risk! synetics does not provide any guarantee or support and excludes a liability for any subsequent damage.

**bbbs.sh**

[?](#)

|     |     |
| --- | --- |
| 1<br><br>2<br><br>3<br><br>4<br><br>5<br><br>6<br><br>7<br><br>8<br><br>9<br><br>10<br><br>11<br><br>12<br><br>13<br><br>14<br><br>15<br><br>16<br><br>17<br><br>18<br><br>19<br><br>20<br><br>21<br><br>22<br><br>23<br><br>24<br><br>25<br><br>26<br><br>27<br><br>28<br><br>29<br><br>30<br><br>31<br><br>32<br><br>33<br><br>34<br><br>35<br><br>36<br><br>37<br><br>38<br><br>39<br><br>40<br><br>41<br><br>42<br><br>43<br><br>44<br><br>45<br><br>46<br><br>47<br><br>48<br><br>49<br><br>50<br><br>51<br><br>52<br><br>53<br><br>54<br><br>55<br><br>56<br><br>57<br><br>58<br><br>59<br><br>60<br><br>61<br><br>62<br><br>63<br><br>64<br><br>65<br><br>66<br><br>67<br><br>68<br><br>69<br><br>70<br><br>71<br><br>72<br><br>73<br><br>74<br><br>75<br><br>76<br><br>77<br><br>78<br><br>79<br><br>80<br><br>81<br><br>82<br><br>83<br><br>84<br><br>85<br><br>86<br><br>87<br><br>88<br><br>89<br><br>90<br><br>91<br><br>92<br><br>93<br><br>94<br><br>95<br><br>96<br><br>97<br><br>98<br><br>99<br><br>100<br><br>101<br><br>102<br><br>103<br><br>104<br><br>105<br><br>106<br><br>107<br><br>108<br><br>109<br><br>110<br><br>111<br><br>112<br><br>113<br><br>114<br><br>115<br><br>116<br><br>117<br><br>118<br><br>119<br><br>120<br><br>121<br><br>122<br><br>123<br><br>124<br><br>125<br><br>126<br><br>127<br><br>128<br><br>129<br><br>130<br><br>131<br><br>132<br><br>133<br><br>134<br><br>135<br><br>136<br><br>137<br><br>138<br><br>139<br><br>140<br><br>141<br><br>142<br><br>143<br><br>144<br><br>145<br><br>146<br><br>147<br><br>148<br><br>149<br><br>150<br><br>151<br><br>152 | `#!/bin/bash`<br><br>`#### System requirements`<br><br>`#### The following tools need to be installed:`<br><br>`###`<br><br>`### mysql - for the MySQL database backup`<br><br>`### tar - for the file backup`<br><br>`### ncftp - for the FTP file copy`<br><br>`### samba-common - For the CIFS file copy`<br><br>`### cifs-utils - For the CIFS file copy`<br><br>`###`<br><br>`### Debian install example:`<br><br>`### apt-get install samba-common cifs-utils ncftp mysql-client tar`<br><br>`## Global configuration options`<br><br>`glob_machine=``"idoitserver"`                  `#Machine name to label backup files`<br><br>`glob_date=$(``date` `+``"%Y-%m-%d_%H%M"``)` `#Date format to label backup files (default is 2015-12-12_1755)`<br><br>`glob_path=``"/tmp/backup/${glob_machine}"`     `#Specify local backup path`<br><br>`glob_delete=0` `#Delete local files immediately after CIFS or FTP copy?`<br><br>`## Database backup configuration`<br><br>`backup_database=1` `#Database backup enabled?`<br><br>`db_user=``""`                                  `#MySQL username`<br><br>`db_pass=``""`                                  `#MySQL password`<br><br>`db_host=``"127.0.0.1"`                         `#MySQL host`<br><br>`db_names=``"idoit_system idoit_data"`          `#Database names to backup separated with space`<br><br>`## File backup configuration`<br><br>`backup_file=1` `#File backup enabled?`<br><br>`file_files=``"/var/www"`                       `#File paths to backup separated with space`<br><br>`## FTP configuration`<br><br>`copy_ftp=0` `#Copy files to FTP server?`<br><br>`ftp_user=``""`                                 `#FTP username`<br><br>`ftp_pass=``""`                                 `#FTP password`<br><br>`ftp_host=``""`                                 `#FTP servername or IP address`<br><br>`ftp_path=``"/backup/path"`                     `#Backup path on FTP server`<br><br>`## CIFS configuration`<br><br>`copy_cifs=0` `#Copy files to CIFS Share?`<br><br>`cifs_user=``""`                                `#CIFS username`<br><br>`cifs_pass=``""`                                `#CIFS pass`<br><br>`cifs_path=``"//cifs/file/share/path"`          `#CIFS backup path`<br><br>`cifs_mount=``"/tmp/backup/cifs_mnt"`           `#CIFS share mount point`<br><br>`cifs_domain=``""`                              `#CIFS domain name`<br><br>`## Old files deletion`<br><br>`delete_file=0` `#Delete old local backups?`<br><br>`delete_file_age=7` `#Delete local backups older than x days`<br><br>`delete_cifs=0` `#Delete old cifs backups?`<br><br>`delete_cifs_age=7` `#Delete cifs backups older than x days`<br><br>`#-------------------------- Stop editing here --------------------------`<br><br>`mkdir` `-p ${glob_path}`<br><br>`umask` `177`<br><br>`#Mount CIFS share`<br><br>`if` `[ $copy_cifs -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Mounting CIFS share ${cifs_path} to ${cifs_mount}"`<br><br>`mkdir` `-p ${cifs_mount}`<br><br>`/sbin/mount``.cifs ${cifs_path} ${cifs_mount} -o user=${cifs_user},domain=${cifs_domain},password=${cifs_pass}`<br><br>`fi`<br><br>`#Database backup`<br><br>`if` `[ $backup_database -``eq` `1 ];`<br><br>`then`<br><br>`for` `i` `in` `${db_names}`<br><br>`do`<br><br>`if` `[ -n` `"$i"` `];`<br><br>`then`<br><br>`tmp_sqlfile=${glob_path}/${glob_machine}__${i}__${glob_date}.sql`<br><br>`echo` `"Dumping MYSQL database ${i} to file ${tmp_sqlfile}"`<br><br>`/usr/bin/mysqldump` `--user=${db_user} --password=${db_pass} --host=${db_host} ${i} > ${tmp_sqlfile}`<br><br>`if` `[ $copy_ftp -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Copying ${tmp_sqlfile} to FTP server ${ftp_host}"`<br><br>`/usr/bin/ncftpput` `-u ${ftp_user} -p ${ftp_pass} ${ftp_host} ${ftp_path} ${tmp_sqlfile}`<br><br>`fi`<br><br>`if` `[ $copy_cifs -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Copying ${tmp_sqlfile} to CIFS share ${cifs_path}"`<br><br>`cp` `-f ${tmp_sqlfile} ${cifs_mount}`<br><br>`fi`<br><br>`if` `[ $glob_delete -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Immediately deleting file ${tmp_sqlfile}"`<br><br>`rm` `-f ${tmp_sqlfile}`<br><br>`fi`<br><br>`fi`<br><br>`done`<br><br>`fi`<br><br>`#File backup`<br><br>`if` `[ $backup_file -``eq` `1 ];`<br><br>`then`<br><br>`j=1`<br><br>`for` `i` `in` `${file_files}`<br><br>`do`<br><br>`if` `[ -n` `"$i"` `];`<br><br>`then`<br><br>`tmp_filesfile=${glob_path}/${glob_machine}__${j}__${glob_date}.``tar``.gz`<br><br>`echo` `"Packing files ${i} to ${tmp_filesfile}"`<br><br>`tar` `czf ${tmp_filesfile} $i`<br><br>`j=$((j + 1))`<br><br>`if` `[ $copy_ftp -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Copying ${tmp_filesfile} to FTp server ${ftp_host}"`<br><br>`/usr/bin/ncftpput` `-u ${ftp_user} -p ${ftp_pass} ${ftp_host} ${ftp_path} ${tmp_filesfile}`<br><br>`fi`<br><br>`if` `[ $copy_cifs -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Copying ${tmp_filesfile} to CIFS share ${cifs_path}"`<br><br>`cp` `-f ${tmp_filesfile} ${cifs_mount}`<br><br>`fi`<br><br>`if` `[ $glob_delete -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Immediately deleting file ${tmp_filesfile}"`<br><br>`rm` `-f ${tmp_filesfile}`<br><br>`fi`<br><br>`fi`<br><br>`done`<br><br>`fi`<br><br>`#old backup deletion`<br><br>`if` `[ $delete_file -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Deleting files older than ${delete_file_age} days in ${glob_path}"`<br><br>`find` `${glob_path} -maxdepth 1 -mtime +${delete_file_age} -``exec` `rm` `{} \;`<br><br>`fi`<br><br>`if` `[ $copy_cifs -``eq` `1 ];`<br><br>`then`<br><br>`if` `[ $delete_cifs -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"Deleting files older than ${delete_cifs_age} days on CIFS share ${cifs_mount}"`<br><br>`find` `${cifs_mount} -maxdepth 1 -mtime +${delete_cifs_age} -``exec` `rm` `{} \;`<br><br>`fi`<br><br>`fi`<br><br>`#Not implemented so far`<br><br>`#if [ $copy_ftp -eq 1 ];`<br><br>`#then`<br><br>`#`<br><br>`#fi`<br><br>`#Umount CIFS share`<br><br>`if` `[ $copy_cifs -``eq` `1 ];`<br><br>`then`<br><br>`echo` `"umounting CIFS share ${cifs_mount}"`<br><br>`umount` `${cifs_mount}`<br><br>`fi` |